* Ideas
** tema pmovto/triggers/paso a TCL
Hoy [2018-02-22 jue] corrijo el ultimo trigger de pagos y ventas upd
para tener todo pmovto con TCL de nuevo, eso rompe la funcionalidad de
python, en el pasado de ventas y recibos.
Lo cual hace obsoleto muchas cosas. pero por lo menos comienzo a
corregir algo.
Con los tests y las correcciones a la base de datos, luego la
depuracion que seria el borrado de lo que no voy a usar o sea las
tablas que no se usan y son obsoletas.
Y la entrada de datos con verificacion para que no haya errores.
** Correccion de datos/Auditoria/Reformulacion de la Base de datos
*** Test.tcl
**** script para correr y dejar asentadas pruebas
un monton de pruebas acumulables que permiten verificar cosas en la
base de datos y emitir resultados, los cuales a medida que se corrijan
tienen que desaparecer.
Incluso se pueden poner alli algunos scripts para corregir si hace
falta.
**** mantencion de sqlite
***** vacuum
achica a casi la mitad la base de datos
***** pragma integrity_check
** Verificacion de entrada de datos en la Venta
*** Verificacion visual de datos corregidos
hacer un tbs donde se vean los campos aclaracion/horario/msgcobr etc
que puedan haberse corregido y se pueda editar alli mismo.
**** TODO corregir bug de borrar datos
no se pq en la edicion me da error si borro datos
cuando en viejas interfaces tcl anda bien
*** TODO ver si hay deudas viejas para condonar
la idea es que al visualizar las ventas pasadas me resalte solo si el
cliente tiene deudas viejas condonables y desaparezca cuando haya sido
condonado
*** TODO linkear los tab con idvta a dobleclick vision ficha con zathura
cosa de poder inspeccionar rapido si todo esta bien en la ficha.
** Nueva ficha
*** mejoras con pdf4tcl lo unico que hay
**** encapsulamiento de cell
empaquete una class emulando el cell del fpdf de python, o sea con
cell [unique] $pdf x text
tengo la celda en la coordenada x y e el valor actual para las y que
lo averigua solo y luego posisiona solo para el siguiente comando, el
texto que se le indica y averigua el ancho y hace el rectangulo de
acuerdo al alto que da la letra.
**** nuevos comandos a usar
$pdf moveTextPosition x y para reposicionar los siguiente comandos de
textos y no depender del flujo de la variable y, y del incr. 
En caso de que no pagine solo, tendria que encapsularlo a este comando
y hacer que compare el valor obtenido de y en cada momento y pagine
correcta y automaticamente.
getTextPosition es util al respecto como tupla de x y para saber la
posicion
*** idea de nueva ficha
creo que se podria hacer la nueva ficha con un encabezado grande de la
operacion, con el valor de la compra.
Restar los pagos realizados y obtener el saldo de la cuenta, y a
continuacion las cuotas a pagar. Alli se deberia ver el tema del vto
para no confundir, o sea con los casos de vencimientos ya vencidos.
** Bugs e ideas
*** DONE bug de busqueda padron femenino por dni
buscar p.e. 5359959 vega maria o buscar por dni a savid silvia
argentina y no las encuentra pero si por nombre.
era que por mas que pusieramos el cero adelante lo tomaba como hexa.
y/o no lo tomaba pq lo trabajaba como int.
tuve que ponerle comillas para que lo busque como string y hacer la
completacion de ceros a la izquierda.

*** DONE idea poner en la tabla de revision de ventas la zona pq puede ser un error 
que cometa la cami de interpretacion
*** DONE hacer que en el listado de revision de ventas marque los que tengan deudas condonables
para que no nos traguemos deudas condonables
*** DONE pensar todos los test que se pueden agregar que descubririan errores de pasado
al menos anote estos dos.
*** TODO estudiar luego el tema condonada
para hacerlo desde ventas.tcl y poder hacerlo reversible que todo lo
haga el trigger o sea que uno solo toggee el campo condonada de 1 a 0
y de 0 a 1.
el problema es que no se podra hacer desde ventas.tcl pq tenes que ver
la venta.
*** DONE arreglar el bug de clientes.cuota que todos tienen el mismo valor
- State "DONE"       from "TODO"       [2018-02-28 mié 10:49]
debe ser un error en trigger que no pone el numero de idcliente.
*** DONE que no permita ingresar letras en cnt bug indu 
*** DONE que el recalc borre la info de editables
hice dos variables coleditables y coleditablesconcb y dos metodos
setcoleditables y setcoleditablesconcb
y cuando quiero que tenga columnas editables pongo tbl setcoleditables {cols}
*** DONE return $text en starteditcommand hace que veas lo que editas aunque sea campo texto
p.e. en detalle venta
*** DONE bug en edicion de tab nuevos
- State "DONE"       from "TODO"       [2018-02-28 mié 12:33]
no se pq no funciona que los campos sean editables y estoy cansado
para encontrarlo.
era que se recalculaba al abrirse desde la apertura del tab en el
raisecmd
*** TODO ver el caso de llenar un tbls con un set de datos que no provenga de un select
como cuotaspagar, y como consigo funcion sumar.
quizas sea mas facil revisar que pasa ahi con el metodo totalizar.
un nuevo sumador con un searchcolumn de regexp con valor numerico
*** TODO bug 66224 o sea edite detvta y no se refleja en ventas.cnt y ventas.art
ver en test.tcl poner una regeneracion de esos campos con la misma
formula que en los triggers pq son campos redundantes y solo
informativos. (como el clientes.cuota,clientes.ultcompra,etc.)
estudiar si en la edicion de detalle de venta en ventas.tcl se podria
agregar borrado de detvta (facil) y la insersion de un registro
(child) en el tree que permita una edicion mas completa de un detalle
de venta de una operacion sin tener que apelar a tener que ir a la
base de datos en pelo como hice siempre en el todos estos años o tener
que ir a un programa de python pq no tenemos una funcionalidad en uno
de tcl.
*** DONE ver si se puede hacer que el ancho de columnas quede tambien para el recalc
*** DONE en mostrar errores limitar el tamaño de campo art pq en mi pantallita no se puede trabajar
*** TODO problema del \n en los comentarios
por el momento lo mejor es ir corrigiendo los comentarios a mano como
un error de tipeado sacando los saltos de linea hasta que desaparezcan.

*** DONE perfeccionar class campo num
    con metodos de aumento y disminucion de valor
    ya que el campo solo admite numeros tiene dos bind que aumentan 
    /decrementan el numero

** tips y workarounds
*** format %0.0f $var para expresar el valor entero
    :DEADLINE: <2018-04-03 Tue>
que es la forma que lo usa el proc cur (a diferencia del curr antiguo
que usa el %0.2f) 
tener en cuenta que dentro de un bind hay que duplicar %%
poner format %%0.0f

*** select en un eval o en un onecolumn que lleva variable a evaluar
    :DEADLINE: <2018-04-01 Sun>
    no confundir sigue las reglas de TCL.
    quebradero de cabeza con esta situacion:
    set total [db onecolumn {select sum(imp+rec) from pagos where
    cobr=$cobr and fecha='$fecha'}]
    no funcionaba!!!
    y claro no lo iba a hacer pq al estar entre llaves no se evaluaban las 
    variables cobr y fecha. Lo tenia que pasar entre comillas. para que se 
    evaluen.
